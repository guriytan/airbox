# Airbox

使用Golang+echo搭建的云储存后台API服务，本项目不包括页面部分，使用RESTful风格获取json数据。

想要查看前端页面请去 [aribox-vue](https://github.com/guriytan/airbox-vue)

## 更新

### 2020年6月5号
1. 重新设计了一些数据表结构，降低了数据库的文件信息和硬盘文件的耦合，预留了md5秒传和分享保存的字段
2. 降低了上传、复制和删除中磁盘的负担（重复利用硬盘保存的文件）
3. 更改了日志记录策略，利用了pkg/errors中记录堆栈信息的错误跟踪 
   
### 2021年3月13号
1. 不再使用协程控制上传，改用minio进行文件操作
2. 修改层级结构，修改为int64作为数据库主键
3. 实现秒传

## TODO

1. ~~fix: 复制/移动文件夹~~
1. ~~实现秒传功能~~
2. 离线下载
3. 打包下载/多选操作

### 注意

你需要创建`config.yml`文件配置启动信息，具体每个字段的含义在`config/env.go`中有comment。

### 项目主要功能

- 使用自行编写的用户逻辑管理账户。
- 文件的管理，包括上传、下载、重命名、删除、移动、复制和分享等。
- 文件夹的管理，包括创建、删除、重命名和移动、复制。
- 文件的分类查看。
- 文件类型的统计数据和用户容量显示

#### 上传与下载

- 上传文件由于使用流的方式进行上传，因此需要传入文件大小作为url参数，且在上传文件后将会对比实际大小以及文件大小参数，若不一致则会返回错误。 每个用户拥有20G的空间，因此当上传文件时容量不足也会返回空间不足的错误。 后台对
  request 的 multipartReader 流进行分块处理，使用 minio 作为 oss 文件处理功能。

- 用户需要登录后才能下载文件，且支持断点续传和分片下载功能。若需要无权限下载文件，请使用分享文件功能。 主要通过将文件ID以及过期时间进行对称加密作为分享链接，后台通过解析链接获取是否过期以及文件ID进行下载。

### 数据库设计

![数据库](https://guriytan-blog1.oss-cn-zhangjiakou.aliyuncs.com/cloud.png?x-oss-process=style/mid)
