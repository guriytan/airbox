# Airbox
使用Golang+echo搭建的云储存后台API服务，本项目不包括页面部分，使用RESTful风格获取json数据。

想要查看前端页面请去 [aribox-vue](https://github.com/guriytan/airbox-vue)

## TODO
1. ~~单点登录~~
2. ~~图片、视频、音频预览~~(~~勉强算是实现，有一个bug就是当预览之后可能因为服务器未能及时释放资源所以删除磁盘文件会报错~~)
原来是因为打开文件后没有调用close方法导致文件被占用，现在已修复
3. ~~优化上传~~
4. ~~实现分片Hash的秒传功能~~(在前端分块计算文件的MD5并传递到后端，由于考虑不能通过将md5作为唯一key，因此不实现秒传功能)
5. 离线下载
6. 打包下载/多选操作

### 注意
你需要创建`config.yml`文件配置启动信息，具体每个字段的含义在`config/env.go`中有comment。

### 项目主要功能

- 使用自行编写的用户逻辑管理账户。
- 文件的管理，包括上传、下载、重命名、删除、移动、复制和分享等。
- 文件夹的管理，包括创建、删除、重命名和移动、复制。
- 文件的分类查看。
- 文件类型的统计数据和用户容量显示

#### 上传与下载
- 上传文件由于使用流的方式进行上传，因此需要传入文件大小作为url参数，且在上传文件后将会对比实际大小以及文件大小参数，若不一致则会返回错误。
每个用户拥有20G的空间，因此当上传文件时容量不足也会返回空间不足的错误。
后台对 request 的 multipartReader 流进行分块处理，使用单生产者和多消费者模型进行多协程上传，并利用通道控制上传。

- 用户需要登录后才能下载文件，且支持断点续传和分片下载功能。若需要无权限下载文件，请使用分享文件功能。
主要通过将文件ID以及过期时间进行对称加密作为分享链接，后台通过解析链接获取是否过期以及文件ID进行下载。

### 数据库设计
![数据库](https://guriytan-blog1.oss-cn-zhangjiakou.aliyuncs.com/cloud.png?x-oss-process=style/mid)
